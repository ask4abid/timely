<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Giant world clock display for any location">
    <title>TIMELY - Giant Clock Display</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="src/css/simple-styles.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ•</text></svg>">
</head>
<body>
    <!-- Main Content -->
    <main class="main-content">
        <!-- Primary Time Display - Large and Prominent with Switch Capability -->
        <div class="hero-time-section">
            <div class="location-header">
                <h1 class="location-title" id="locationTitle">Time in Your Location now</h1>
                <div class="location-subtitle" id="locationSubtitle">Loading location...</div>
                <button class="switch-location-btn" id="switchLocationBtn" onclick="toggleLocationPicker()">
                    <span class="switch-icon">
                        <svg width="16" height="16" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="switchClockGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#f8fafc;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#e2e8f0;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="switchHandsGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#4299e1;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#667eea;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle cx="22" cy="22" r="18" 
                                    fill="url(#switchClockGradient)" 
                                    stroke="#667eea" 
                                    stroke-width="1.5"/>
                            <g stroke="#718096" stroke-width="1" opacity="0.6">
                                <line x1="22" y1="6" x2="22" y2="9"/>
                                <line x1="38" y1="22" x2="38" y2="22"/>
                                <line x1="22" y1="38" x2="22" y2="35"/>
                                <line x1="6" y1="22" x2="9" y2="22"/>
                            </g>
                            <g stroke="url(#switchHandsGradient)" stroke-width="1.5" stroke-linecap="round">
                                <line x1="22" y1="22" x2="17" y2="16"/>
                                <line x1="22" y1="22" x2="28" y2="14"/>
                            </g>
                            <circle cx="22" cy="22" r="1.5" fill="#667eea"/>
                        </svg>
                    </span>
                    Change Location
                </button>
            </div>
            <div class="giant-clock-display" id="giantClockDisplay">
                <div class="clock-location-info" id="clockLocationInfo">
                    <span class="location-flag" id="locationFlag">ğŸŒ</span>
                    <span class="location-name" id="locationName">Local Time</span>
                    <span class="location-country" id="locationCountry">Your Location</span>
                </div>
                <div class="main-time" id="primaryTime">00:00:00</div>
                <div class="main-date" id="primaryDate">Loading...</div>
                <div class="sun-times" id="sunTimes">
                    <span class="sun-icon">â˜€ï¸</span>
                    <span class="sun-info" id="sunInfo">â†‘ 06:30 â†“ 18:45 (12h 15m)</span>
                </div>
            </div>
        </div>

        <!-- Location Picker Modal -->
        <div class="location-picker-overlay" id="locationPickerOverlay">
            <div class="location-picker-modal">
                <div class="modal-header">
                    <div class="header-content">
                        <h3>ğŸŒ Change Location</h3>
                        <p class="modal-subtitle">Search and select any city worldwide</p>
                    </div>
                    <button class="close-modal" onclick="toggleLocationPicker()">Ã—</button>
                </div>
                <div class="modal-body">
                    <!-- Search Section -->
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <input type="text" 
                                   id="citySearchInput" 
                                   placeholder="ğŸ” Search cities worldwide (e.g., New York, London, Tokyo)..." 
                                   class="city-search-input" 
                                   autocomplete="off"
                                   oninput="searchCities(this.value)"
                                   autofocus>
                            <div class="search-icon">ğŸ”</div>
                        </div>
                        <!-- Search Results -->
                        <div class="search-results" id="searchResults" style="display: none;">
                            <div class="results-header">
                                <h5>Search Results</h5>
                                <span class="results-count" id="resultsCount">0 cities found</span>
                            </div>
                            <div class="search-results-list" id="searchResultsList">
                                <!-- Will be populated with search results -->
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="quick-action-btn detect-btn" onclick="detectMyLocation()">
                            <span class="action-icon">ğŸ“</span>
                            <span class="action-text">Detect My Location</span>
                        </button>
                    </div>

                    <!-- Popular Cities Grid -->
                    <div class="popular-section">
                        <h4 class="section-title">Popular Cities</h4>
                        <div class="popular-cities-grid" id="popularCitiesGrid">
                            <!-- Major Cities -->
                            <div class="continent-section">
                                <h5 class="continent-title">ğŸŒ North America</h5>
                                <div class="cities-row">
                                    <button class="city-btn" onclick="selectLocation('New York', 'America/New_York', 'ğŸ‡ºğŸ‡¸')">New York</button>
                                    <button class="city-btn" onclick="selectLocation('Los Angeles', 'America/Los_Angeles', 'ğŸ‡ºğŸ‡¸')">Los Angeles</button>
                                    <button class="city-btn" onclick="selectLocation('Chicago', 'America/Chicago', 'ğŸ‡ºğŸ‡¸')">Chicago</button>
                                    <button class="city-btn" onclick="selectLocation('Toronto', 'America/Toronto', 'ğŸ‡¨ğŸ‡¦')">Toronto</button>
                                </div>
                            </div>
                            
                            <div class="continent-section">
                                <h5 class="continent-title">ğŸŒ Europe</h5>
                                <div class="cities-row">
                                    <button class="city-btn" onclick="selectLocation('London', 'Europe/London', 'ğŸ‡¬ğŸ‡§')">London</button>
                                    <button class="city-btn" onclick="selectLocation('Paris', 'Europe/Paris', 'ğŸ‡«ğŸ‡·')">Paris</button>
                                    <button class="city-btn" onclick="selectLocation('Berlin', 'Europe/Berlin', 'ğŸ‡©ğŸ‡ª')">Berlin</button>
                                    <button class="city-btn" onclick="selectLocation('Rome', 'Europe/Rome', 'ğŸ‡®ğŸ‡¹')">Rome</button>
                                </div>
                            </div>
                            
                            <div class="continent-section">
                                <h5 class="continent-title">ğŸŒ Asia</h5>
                                <div class="cities-row">
                                    <button class="city-btn" onclick="selectLocation('Tokyo', 'Asia/Tokyo', 'ğŸ‡¯ğŸ‡µ')">Tokyo</button>
                                    <button class="city-btn" onclick="selectLocation('Shanghai', 'Asia/Shanghai', 'ğŸ‡¨ğŸ‡³')">Shanghai</button>
                                    <button class="city-btn" onclick="selectLocation('Seoul', 'Asia/Seoul', 'ğŸ‡°ğŸ‡·')">Seoul</button>
                                    <button class="city-btn" onclick="selectLocation('Dubai', 'Asia/Dubai', 'ğŸ‡¦ğŸ‡ª')">Dubai</button>
                                </div>
                            </div>
                            
                            <div class="continent-section">
                                <h5 class="continent-title">ğŸŒ Oceania</h5>
                                <div class="cities-row">
                                    <button class="city-btn" onclick="selectLocation('Sydney', 'Australia/Sydney', 'ğŸ‡¦ğŸ‡º')">Sydney</button>
                                    <button class="city-btn" onclick="selectLocation('Melbourne', 'Australia/Melbourne', 'ğŸ‡¦ğŸ‡º')">Melbourne</button>
                                    <button class="city-btn" onclick="selectLocation('Auckland', 'Pacific/Auckland', 'ğŸ‡³ğŸ‡¿')">Auckland</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Core JavaScript -->
    <script>
        // Global cities database for search
        const globalCitiesDatabase = [
            // North America
            { name: 'New York', timezone: 'America/New_York', flag: 'ğŸ‡ºğŸ‡¸', country: 'United States' },
            { name: 'Los Angeles', timezone: 'America/Los_Angeles', flag: 'ğŸ‡ºğŸ‡¸', country: 'United States' },
            { name: 'Chicago', timezone: 'America/Chicago', flag: 'ğŸ‡ºğŸ‡¸', country: 'United States' },
            { name: 'Miami', timezone: 'America/New_York', flag: 'ğŸ‡ºğŸ‡¸', country: 'United States' },
            { name: 'San Francisco', timezone: 'America/Los_Angeles', flag: 'ğŸ‡ºğŸ‡¸', country: 'United States' },
            { name: 'Toronto', timezone: 'America/Toronto', flag: 'ğŸ‡¨ğŸ‡¦', country: 'Canada' },
            { name: 'Vancouver', timezone: 'America/Vancouver', flag: 'ğŸ‡¨ğŸ‡¦', country: 'Canada' },
            { name: 'Mexico City', timezone: 'America/Mexico_City', flag: 'ğŸ‡²ğŸ‡½', country: 'Mexico' },
            // Europe
            { name: 'London', timezone: 'Europe/London', flag: 'ğŸ‡¬ğŸ‡§', country: 'United Kingdom' },
            { name: 'Paris', timezone: 'Europe/Paris', flag: 'ğŸ‡«ğŸ‡·', country: 'France' },
            { name: 'Berlin', timezone: 'Europe/Berlin', flag: 'ğŸ‡©ğŸ‡ª', country: 'Germany' },
            { name: 'Rome', timezone: 'Europe/Rome', flag: 'ğŸ‡®ğŸ‡¹', country: 'Italy' },
            { name: 'Madrid', timezone: 'Europe/Madrid', flag: 'ğŸ‡ªğŸ‡¸', country: 'Spain' },
            { name: 'Amsterdam', timezone: 'Europe/Amsterdam', flag: 'ğŸ‡³ğŸ‡±', country: 'Netherlands' },
            { name: 'Stockholm', timezone: 'Europe/Stockholm', flag: 'ğŸ‡¸ğŸ‡ª', country: 'Sweden' },
            { name: 'Moscow', timezone: 'Europe/Moscow', flag: 'ğŸ‡·ğŸ‡º', country: 'Russia' },
            // Asia
            { name: 'Tokyo', timezone: 'Asia/Tokyo', flag: 'ğŸ‡¯ğŸ‡µ', country: 'Japan' },
            { name: 'Shanghai', timezone: 'Asia/Shanghai', flag: 'ğŸ‡¨ğŸ‡³', country: 'China' },
            { name: 'Beijing', timezone: 'Asia/Shanghai', flag: 'ğŸ‡¨ğŸ‡³', country: 'China' },
            { name: 'Seoul', timezone: 'Asia/Seoul', flag: 'ğŸ‡°ğŸ‡·', country: 'South Korea' },
            { name: 'Singapore', timezone: 'Asia/Singapore', flag: 'ğŸ‡¸ğŸ‡¬', country: 'Singapore' },
            { name: 'Hong Kong', timezone: 'Asia/Hong_Kong', flag: 'ğŸ‡­ğŸ‡°', country: 'Hong Kong' },
            { name: 'Mumbai', timezone: 'Asia/Kolkata', flag: 'ğŸ‡®ğŸ‡³', country: 'India' },
            { name: 'Delhi', timezone: 'Asia/Kolkata', flag: 'ğŸ‡®ğŸ‡³', country: 'India' },
            { name: 'Bangkok', timezone: 'Asia/Bangkok', flag: 'ğŸ‡¹ğŸ‡­', country: 'Thailand' },
            { name: 'Dubai', timezone: 'Asia/Dubai', flag: 'ğŸ‡¦ğŸ‡ª', country: 'UAE' },
            // Oceania
            { name: 'Sydney', timezone: 'Australia/Sydney', flag: 'ğŸ‡¦ğŸ‡º', country: 'Australia' },
            { name: 'Melbourne', timezone: 'Australia/Melbourne', flag: 'ğŸ‡¦ğŸ‡º', country: 'Australia' },
            { name: 'Auckland', timezone: 'Pacific/Auckland', flag: 'ğŸ‡³ğŸ‡¿', country: 'New Zealand' },
            { name: 'Perth', timezone: 'Australia/Perth', flag: 'ğŸ‡¦ğŸ‡º', country: 'Australia' },
            // South America
            { name: 'SÃ£o Paulo', timezone: 'America/Sao_Paulo', flag: 'ğŸ‡§ğŸ‡·', country: 'Brazil' },
            { name: 'Rio de Janeiro', timezone: 'America/Sao_Paulo', flag: 'ğŸ‡§ğŸ‡·', country: 'Brazil' },
            { name: 'Buenos Aires', timezone: 'America/Argentina/Buenos_Aires', flag: 'ğŸ‡¦ğŸ‡·', country: 'Argentina' },
            { name: 'Lima', timezone: 'America/Lima', flag: 'ğŸ‡µğŸ‡ª', country: 'Peru' },
            { name: 'Santiago', timezone: 'America/Santiago', flag: 'ğŸ‡¨ğŸ‡±', country: 'Chile' }
        ];

        // Global state management
        window.timelyAppState = {
            currentLocationData: null,
            clockInterval: null,
            isClockRunning: false,
            isModalOpen: false
        };

        // Search functionality
        function searchCities(query) {
            const searchResults = document.getElementById('searchResults');
            const searchResultsList = document.getElementById('searchResultsList');
            const resultsCount = document.getElementById('resultsCount');
            
            if (!query || query.trim().length < 2) {
                searchResults.style.display = 'none';
                return;
            }
            
            const filteredCities = globalCitiesDatabase.filter(city => 
                city.name.toLowerCase().includes(query.toLowerCase()) ||
                city.country.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredCities.length > 0) {
                searchResults.style.display = 'block';
                resultsCount.textContent = `${filteredCities.length} cities found`;
                searchResultsList.innerHTML = filteredCities.map(city => `
                    <div class="search-result-item">
                        <div class="city-info">
                            <span class="city-flag">${city.flag}</span>
                            <div class="city-details">
                                <span class="city-name">${city.name}</span>
                                <span class="city-country">${city.country}</span>
                            </div>
                        </div>
                        <button class="add-to-favorites-btn" 
                                onclick="selectLocation('${city.name}', '${city.timezone}', '${city.flag}')"
                                title="Select ${city.name}">
                            âœ“ Select
                        </button>
                    </div>
                `).join('');
            } else {
                searchResults.style.display = 'block';
                resultsCount.textContent = 'No cities found';
                searchResultsList.innerHTML = '<div class="no-results">No cities match your search. Try a different term.</div>';
            }
        }

        // Location Detection
        async function detectMyLocation() {
            const detectBtn = document.querySelector('.detect-btn');
            const originalText = detectBtn.innerHTML;
            
            detectBtn.innerHTML = '<span class="action-icon">â³</span><span class="action-text">Detecting...</span>';
            detectBtn.disabled = true;
            
            try {
                if (!navigator.geolocation) {
                    throw new Error('Geolocation is not supported by this browser');
                }
                
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 600000
                    });
                });
                
                const { latitude, longitude } = position.coords;
                const locationData = await reverseGeocode(latitude, longitude);
                
                if (locationData) {
                    selectLocation(locationData.city, locationData.timezone, locationData.flag, locationData.country);
                    showNotification(`ğŸ“ Location detected: ${locationData.city}`, 'success');
                } else {
                    throw new Error('Could not determine your city');
                }
            } catch (error) {
                console.error('Location detection error:', error);
                showNotification('Location detection failed. Please select manually.', 'error');
            } finally {
                detectBtn.innerHTML = originalText;
                detectBtn.disabled = false;
            }
        }

        // Reverse geocoding
        async function reverseGeocode(lat, lon) {
            try {
                const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
                if (!response.ok) throw new Error('Geocoding service unavailable');
                
                const data = await response.json();
                const city = data.city || data.locality || data.principalSubdivision;
                const country = data.countryName;
                const countryCode = data.countryCode;
                
                if (!city) throw new Error('City not found');
                
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const flag = getCountryFlag(countryCode);
                
                return { city, country, timezone, flag, coordinates: { lat, lon } };
            } catch (error) {
                console.error('Reverse geocoding failed:', error);
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const parts = timezone.split('/');
                const city = parts[parts.length - 1].replace(/_/g, ' ');
                return { city, country: 'Your Location', timezone, flag: 'ğŸŒ', coordinates: { lat, lon } };
            }
        }

        // Get country flag
        function getCountryFlag(countryCode) {
            if (!countryCode || countryCode.length !== 2) return 'ğŸŒ';
            const flagMap = {
                'US': 'ğŸ‡ºğŸ‡¸', 'CA': 'ğŸ‡¨ğŸ‡¦', 'GB': 'ğŸ‡¬ğŸ‡§', 'FR': 'ğŸ‡«ğŸ‡·', 'DE': 'ğŸ‡©ğŸ‡ª',
                'IT': 'ğŸ‡®ğŸ‡¹', 'ES': 'ğŸ‡ªğŸ‡¸', 'NL': 'ğŸ‡³ğŸ‡±', 'SE': 'ğŸ‡¸ğŸ‡ª', 'RU': 'ğŸ‡·ğŸ‡º',
                'JP': 'ğŸ‡¯ğŸ‡µ', 'CN': 'ğŸ‡¨ğŸ‡³', 'KR': 'ğŸ‡°ğŸ‡·', 'SG': 'ğŸ‡¸ğŸ‡¬', 'HK': 'ğŸ‡­ğŸ‡°',
                'IN': 'ğŸ‡®ğŸ‡³', 'TH': 'ğŸ‡¹ğŸ‡­', 'AE': 'ğŸ‡¦ğŸ‡ª', 'AU': 'ğŸ‡¦ğŸ‡º', 'NZ': 'ğŸ‡³ğŸ‡¿',
                'BR': 'ğŸ‡§ğŸ‡·', 'AR': 'ğŸ‡¦ğŸ‡·', 'PE': 'ğŸ‡µğŸ‡ª', 'CL': 'ğŸ‡¨ğŸ‡±'
            };
            return flagMap[countryCode.toUpperCase()] || 'ğŸŒ';
        }

        // Select location and update display
        function selectLocation(cityName, timezone, flag, country = null) {
            // Create location object
            const locationData = {
                city: cityName,
                timezone: timezone,
                flag: flag,
                country: country || getCountryFromTimezone(timezone) || 'Selected Location'
            };
            
            // Save to localStorage
            try {
                localStorage.setItem('selectedLocation', JSON.stringify(locationData));
                console.log('Location saved to localStorage:', locationData);
            } catch (error) {
                console.log('localStorage not available:', error);
            }
            
            // Close modal
            toggleLocationPicker();
            
            // Update display
            updateLocationDisplay(locationData);
            
            // Start clock updates
            window.timelyAppState.currentLocationData = locationData;
            startClockUpdates(locationData);
            
            // Show notification
            showNotification(`${flag} ${cityName} time selected!`, 'success');
        }

        // Get country from timezone
        function getCountryFromTimezone(timezone) {
            const timezoneMap = {
                'America/New_York': 'United States',
                'America/Los_Angeles': 'United States',
                'America/Chicago': 'United States',
                'America/Toronto': 'Canada',
                'America/Vancouver': 'Canada',
                'Europe/London': 'United Kingdom',
                'Europe/Paris': 'France',
                'Europe/Berlin': 'Germany',
                'Europe/Rome': 'Italy',
                'Asia/Tokyo': 'Japan',
                'Asia/Shanghai': 'China',
                'Asia/Seoul': 'South Korea',
                'Asia/Dubai': 'UAE',
                'Australia/Sydney': 'Australia'
            };
            return timezoneMap[timezone] || 'Selected Location';
        }

        // Update location display
        function updateLocationDisplay(locationData) {
            const locationTitle = document.getElementById('locationTitle');
            const locationSubtitle = document.getElementById('locationSubtitle');
            const locationFlag = document.getElementById('locationFlag');
            const locationName = document.getElementById('locationName');
            const locationCountry = document.getElementById('locationCountry');
            
            if (locationTitle) locationTitle.textContent = `Time in ${locationData.city} now`;
            if (locationSubtitle) locationSubtitle.textContent = `${locationData.country} â€¢ Live Time`;
            if (locationFlag) locationFlag.textContent = locationData.flag;
            if (locationName) locationName.textContent = locationData.city;
            if (locationCountry) locationCountry.textContent = locationData.country;
        }

        // Start clock updates
        function startClockUpdates(locationData) {
            // Clear any existing interval
            if (window.timelyAppState.clockInterval) {
                clearInterval(window.timelyAppState.clockInterval);
            }
            
            const primaryTime = document.getElementById('primaryTime');
            const primaryDate = document.getElementById('primaryDate');
            const sunInfo = document.getElementById('sunInfo');
            
            function updateClock() {
                try {
                    const now = new Date();
                    
                    // Update time
                    if (primaryTime) {
                        const timeString = now.toLocaleTimeString('en-US', {
                            timeZone: locationData.timezone,
                            hour12: false,
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        primaryTime.textContent = timeString;
                    }
                    
                    // Update date
                    if (primaryDate) {
                        const dateString = now.toLocaleDateString('en-US', {
                            timeZone: locationData.timezone,
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        primaryDate.textContent = dateString;
                    }
                    
                    // Update sun times (simplified)
                    if (sunInfo && locationData.coordinates) {
                        const sunTimes = calculateSunTimes(locationData.coordinates.lat, locationData.coordinates.lon, now);
                        sunInfo.textContent = `â†‘ ${sunTimes.sunrise} â†“ ${sunTimes.sunset} (${sunTimes.dayLength})`;
                    }
                } catch (error) {
                    console.error('Clock update error:', error);
                }
            }
            
            // Update immediately and then every second
            updateClock();
            window.timelyAppState.clockInterval = setInterval(updateClock, 1000);
            window.timelyAppState.isClockRunning = true;
        }

        // Calculate sun times (simplified)
        function calculateSunTimes(lat, lon, date) {
            try {
                const now = new Date(date);
                const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                const latRad = lat * Math.PI / 180;
                const declination = 23.45 * Math.PI / 180 * Math.sin(2 * Math.PI * (284 + dayOfYear) / 365);
                const hourAngle = Math.acos(-Math.tan(latRad) * Math.tan(declination));
                const solarNoon = 12 - (lon / 15);
                const sunriseHour = solarNoon - (hourAngle * 12 / Math.PI);
                const sunsetHour = solarNoon + (hourAngle * 12 / Math.PI);
                
                const sunrise = formatHour(sunriseHour);
                const sunset = formatHour(sunsetHour);
                const dayLengthHours = sunsetHour - sunriseHour;
                const dayLength = `${Math.floor(dayLengthHours)}h ${Math.floor((dayLengthHours % 1) * 60)}m`;
                
                return { sunrise, sunset, dayLength };
            } catch (error) {
                return { sunrise: '06:30', sunset: '18:45', dayLength: '12h 15m' };
            }
        }

        // Format hour as HH:MM
        function formatHour(hour) {
            const h = Math.floor(hour);
            const m = Math.floor((hour % 1) * 60);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        }

        // Toggle location picker modal
        function toggleLocationPicker() {
            const modal = document.getElementById('locationPickerOverlay');
            const searchInput = document.getElementById('citySearchInput');
            const searchResults = document.getElementById('searchResults');
            
            if (modal.classList.contains('active')) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
                window.timelyAppState.isModalOpen = false;
                // Clear search
                if (searchInput) searchInput.value = '';
                if (searchResults) searchResults.style.display = 'none';
            } else {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                window.timelyAppState.isModalOpen = true;
                // Focus search input
                setTimeout(() => {
                    if (searchInput) searchInput.focus();
                }, 100);
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-weight: 500;
                z-index: 10000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Initialize application
        function initializeApp() {
            // Load saved location
            let savedLocation = null;
            try {
                const savedLocationData = localStorage.getItem('selectedLocation');
                if (savedLocationData) {
                    savedLocation = JSON.parse(savedLocationData);
                }
            } catch (error) {
                console.log('Could not load saved location:', error);
            }
            
            if (savedLocation && savedLocation.city && savedLocation.timezone) {
                console.log('Loading saved location:', savedLocation.city);
                updateLocationDisplay(savedLocation);
                window.timelyAppState.currentLocationData = savedLocation;
                startClockUpdates(savedLocation);
            } else {
                // Start with local timezone
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const parts = timezone.split('/');
                const city = parts[parts.length - 1].replace(/_/g, ' ');
                
                const defaultLocation = {
                    city: city,
                    country: 'Your Local Time',
                    timezone: timezone,
                    flag: 'ğŸŒ'
                };
                
                updateLocationDisplay(defaultLocation);
                window.timelyAppState.currentLocationData = defaultLocation;
                startClockUpdates(defaultLocation);
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize the app
            setTimeout(initializeApp, 100);
            
            // Close modal when clicking outside
            document.addEventListener('click', (e) => {
                const modal = document.getElementById('locationPickerOverlay');
                if (modal && modal.classList.contains('active') && e.target === modal) {
                    toggleLocationPicker();
                }
            });
            
            // Enter key support for search
            const searchInput = document.getElementById('citySearchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const query = e.target.value.trim();
                        const city = globalCitiesDatabase.find(c => 
                            c.name.toLowerCase() === query.toLowerCase() ||
                            c.name.toLowerCase().includes(query.toLowerCase())
                        );
                        if (city) {
                            selectLocation(city.name, city.timezone, city.flag, city.country);
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
